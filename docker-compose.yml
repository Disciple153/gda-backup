services:
  gda_backup:
    image: disciple153/gda-backup:0.0.1
    environment:
      BACKUP_CRON: "* * * * *"
    env_file:
      - .env
    configs:
      - gda_backup_config
    networks:
      - gda_backup_network
    depends_on:
      - database
    volumes:
      - ./backup_test:/backup:ro
      - ./restore_test:/restore

  database: # If the name of the database is changed, the POSTGRES_HOST environment variable must be set to its name
    image: 'postgres:latest'
    env_file:
      - .env
    volumes:
      - postgres_volume:/var/lib/postgresql/data
    networks:
      - gda_backup_network

volumes:
  postgres_volume:

networks:
  gda_backup_network:

configs:
  gda_backup_config:
    content: |
      dry_run: true
      log_level: debug
      target_dir: /backup
      bucket_name: disciple153-test
      dynamo_table: gda-backup-test
      filters:
        - "test1"
        - "filter2"
      min_storage_duration: 1
